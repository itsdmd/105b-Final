[{"id":"da1e5a53b04b1d78","type":"tab","label":"CS105b Final","disabled":false,"info":""},{"id":"0118c5bf23faa103","type":"ui_button","z":"da1e5a53b04b1d78","name":"IconRefresh","group":"70fb931.dfc146c","order":2,"width":2,"height":2,"passthru":false,"label":"","tooltip":"Refresh","color":"","bgcolor":"","className":"","icon":"fa-refresh 4x","payload":"true","payloadType":"bool","topic":"","topicType":"str","x":1250,"y":280,"wires":[["5650d1680d259116"]]},{"id":"358aaf3d94a2e384","type":"ui_text","z":"da1e5a53b04b1d78","group":"70fb931.dfc146c","order":6,"width":5,"height":"1","name":"Description","label":"","format":"{{msg.payload.current.weather[0].description}}","layout":"row-left","className":"","x":1250,"y":80,"wires":[]},{"id":"be7351e1dd02ac9c","type":"ui_text","z":"da1e5a53b04b1d78","group":"70fb931.dfc146c","order":4,"width":3,"height":"1","name":"Wind","label":"","format":"{{msg.payload.current.wind_speed}}&nbsp;&nbsp;<i class=\"wi wi-darksky-wind\"></i>&nbsp;&nbsp;{{msg.payload.current.wind_cardinal}}","layout":"col-center","className":"","x":1230,"y":160,"wires":[]},{"id":"1aac7190b8b04cfe","type":"ui_text","z":"da1e5a53b04b1d78","group":"70fb931.dfc146c","order":5,"width":3,"height":1,"name":"SunriseTime","label":"","format":"<i class=\"wi wi-owm-01d\"></i>&nbsp;<i class=\"fa fa-arrow-up\"></i>&nbsp;&nbsp;{{msg.payload.current.sunrise}}","layout":"row-center","className":"","x":1250,"y":200,"wires":[]},{"id":"0ff51096c64a0e3a","type":"ui_text","z":"da1e5a53b04b1d78","group":"70fb931.dfc146c","order":7,"width":3,"height":1,"name":"SunsetTime","label":"","format":"<i class=\"wi wi-wu-sunny\"></i>&nbsp;<i class=\"fa fa-arrow-down\"></i>&nbsp;&nbsp;{{msg.payload.current.sunset}}","layout":"row-center","className":"","x":1250,"y":240,"wires":[]},{"id":"295b98011064ab87","type":"ui_template","z":"da1e5a53b04b1d78","group":"70fb931.dfc146c","name":"Forecast Info","order":8,"width":"10","height":"2","format":"<div style=\"height: 100%; justify-content: center; align-items: center;\">\n <div layout=\"rowicons\" layout-align=\"space-around start\" ng-repeat=\"data in msg.payload.rowicons\" style=\"font-size:150%;padding-top: 5px;padding-bottom: 5px\">\n  <span flex style=\"color: black;text-align: center\"><i class=\"wi wi-owm-{{data.cell01}}\"></i></span>\n  <span flex style=\"color: black;text-align: center\"><i class=\"wi wi-owm-{{data.cell02}}\"></i></span>\n  <span flex style=\"color: black;text-align: center\"><i class=\"wi wi-owm-{{data.cell03}}\"></i></span>\n  <span flex style=\"color: black;text-align: center\"><i class=\"wi wi-owm-{{data.cell04}}\"></i></span>\n  <span flex style=\"color: black;text-align: center\"><i class=\"wi wi-owm-{{data.cell05}}\"></i></span>\n  <span flex style=\"color: black;text-align: center\"><i class=\"wi wi-owm-{{data.cell06}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell07}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell08}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell09}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell10}}\"></i></span>\n </div>\n <div layout=\"rowtext\" layout-align=\"space-around start\" ng-repeat=\"data in msg.payload.rowtext\" style=\"line-height: 150%\">\n  <span flex style=\"color: black;text-align: center;\">{{data.cell01}}</span>\n  <span flex style=\"color: black;text-align: center\">{{data.cell02}}</span>\n  <span flex style=\"color: black;text-align: center\">{{data.cell03}}</span>\n  <span flex style=\"color: black;text-align: center\">{{data.cell04}}</span>\n  <span flex style=\"color: black;text-align: center\">{{data.cell05}}</span>\n  <span flex style=\"color: black;text-align: center\">{{data.cell06}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell07}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell08}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell09}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell10}}</span>\n </div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":1250,"y":340,"wires":[[]]},{"id":"af226991fd2ce75c","type":"function","z":"da1e5a53b04b1d78","name":"Format forecast data","func":"var fcdata = {};\nvar units=flow.get('units');\nif (units===undefined)\n{\n  units=\"imperial\";\n}\n\nfunction formatTemp(high, low){\n    if (units == \"imperial\") {\n        if (low){\n          temp = parseFloat(high).toFixed() + '/' + parseFloat(low).toFixed()\n        }\n        else {\n          temp = parseFloat(high).toFixed() + '°F'\n        }\n    }\n    else { // metric\n        if (low){\n          temp = parseFloat(high).toFixed() + '/' + parseFloat(low).toFixed()\n        }\n        else {\n          temp = parseFloat(high).toFixed() + '°C'\n        }\n    }\n    return temp;\n}\n\nfunction dayName(unixTime){\n  var dateObject = new Date(unixTime * 1000);\n  return dateObject.toLocaleString(flow.get('lang'), { timezone: msg.payload.timezone, weekday: 'short'});\n  // If the line above is not producing the correct short weekday names for the language set by 'lang',\n  //   you can try upgrading to NodeJS version 13 or higher (when full international support was added for the toLocaleString function),\n  //   or you can use the code below which is an example for French short weekday names.\n/*  \n  switch (dateObject.toLocaleString('en', { timezone: msg.payload.timezone, weekday: 'short'})) {\n    case 'Mon':\n      return 'Lun';\n    case 'Tue':\n      return 'Mar';\n    case 'Wed':\n      return 'Mer';\n    case 'Thu':\n      return 'Jeu';\n    case 'Fri':\n      return 'Ven';\n    case 'Sat':\n      return 'Sam';\n    case 'Sun':\n      return 'Dim';\n  }\n*/\n}\n\nfunction timeConvert(UNIX_timestamp){\n  var dateObject = new Date(UNIX_timestamp * 1000);\n  if (flow.get('hour12')) {  // 12 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: true, hour: 'numeric'}).toLowerCase();\n  } else {  // 24 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: false, hour: 'numeric'}) + ':00';\n  }      \n}\n\n// prepare forecast data for CSS based ui widget\nfcdata.payload = {\n  rowtext: {\n  \tdata01: {\n      cell01: timeConvert(msg.payload.hourly[1].dt),\n      cell02: timeConvert(msg.payload.hourly[2].dt),\n      cell03: timeConvert(msg.payload.hourly[3].dt),\n      cell04: timeConvert(msg.payload.hourly[4].dt),\n      cell05: timeConvert(msg.payload.hourly[5].dt),\n      cell06: timeConvert(msg.payload.hourly[6].dt),\n      cell07: dayName(msg.payload.daily[1].dt),\n      cell08: dayName(msg.payload.daily[2].dt),\n      cell09: dayName(msg.payload.daily[3].dt),\n      cell10: dayName(msg.payload.daily[4].dt),\n  \t},\n  \tdata02: {\n       cell01: formatTemp(msg.payload.hourly[1].temp),\n       cell02: formatTemp(msg.payload.hourly[2].temp),\n       cell03: formatTemp(msg.payload.hourly[3].temp),\n       cell04: formatTemp(msg.payload.hourly[4].temp),\n       cell05: formatTemp(msg.payload.hourly[5].temp),\n       cell06: formatTemp(msg.payload.hourly[6].temp),\n       cell07: formatTemp(msg.payload.daily[1].temp.max, msg.payload.daily[0].temp.min),\n       cell08: formatTemp(msg.payload.daily[2].temp.max, msg.payload.daily[1].temp.min),\n       cell09: formatTemp(msg.payload.daily[3].temp.max, msg.payload.daily[2].temp.min),\n       cell10: formatTemp(msg.payload.daily[4].temp.max, msg.payload.daily[3].temp.min),\n  \t}\n  },\n  rowicons: {\n  \tdata01: {\n  \t\tcell01: msg.payload.hourly[1].weather[0].icon,\n  \t\tcell02: msg.payload.hourly[2].weather[0].icon,\n  \t\tcell03: msg.payload.hourly[3].weather[0].icon,\n  \t\tcell04: msg.payload.hourly[4].weather[0].icon,\n  \t\tcell05: msg.payload.hourly[5].weather[0].icon,\n  \t\tcell06: msg.payload.hourly[6].weather[0].icon,\n  \t\tcell07: msg.payload.daily[1].weather[0].icon,\n  \t\tcell08: msg.payload.daily[2].weather[0].icon,\n  \t\tcell09: msg.payload.daily[3].weather[0].icon,\n  \t\tcell10: msg.payload.daily[4].weather[0].icon,\n  \t}\n  }\n}\n\nreturn fcdata;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":980,"y":340,"wires":[["295b98011064ab87"]]},{"id":"b0ee7e02fac70e8a","type":"ui_text","z":"da1e5a53b04b1d78","group":"70fb931.dfc146c","order":3,"width":2,"height":"1","name":"Temperature","label":"","format":"<p style=\"font-size: 200%\">{{msg.payload.current.temp}}</p>","layout":"row-left","className":"","x":1250,"y":120,"wires":[]},{"id":"e1178f4b5798dcb3","type":"http request","z":"da1e5a53b04b1d78","name":"Get OWM data","method":"GET","ret":"obj","paytoqs":"query","url":"https://api.openweathermap.org/data/2.5/onecall","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":710,"y":300,"wires":[["6eeb9dfd4fca1478","af226991fd2ce75c","b6b150ace5f7030d"]]},{"id":"cacdc178164fb28a","type":"inject","z":"da1e5a53b04b1d78","name":"Inject","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"300","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":320,"y":260,"wires":[["d5cadd13fcc4a795","7ea09f2132636b36"]]},{"id":"6eeb9dfd4fca1478","type":"function","z":"da1e5a53b04b1d78","name":"Format current data","func":"var icon = {};\n\nvar units = flow.get('units');\nif (units === undefined) {units = 'imperial';}\n\nfunction timeConvert(UNIX_timestamp){\n  var dateObject = new Date(UNIX_timestamp * 1000);\n  if (flow.get('hour12')) {  // 12 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: true, hour: 'numeric', minute: '2-digit'}).toLowerCase();\n  } else {  // 24 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: false, hour: 'numeric', minute: '2-digit'});\n  }      \n}\n\nvar degreesToCardinal = function(deg){\n  if (deg>11.25 && deg<=33.75){return \"NNE\";}\n  else if (deg>33.75 && deg<56.25){return \"NE\";}\n  else if (deg>56.25 && deg<78.75){return \"ENE\";}\n  else if (deg>78.75 && deg<101.25){return \"E\";}\n  else if (deg>101.25 && deg<123.75){return \"ESE\";}\n  else if (deg>123.75 && deg<146.25){return \"SE\";}\n  else if (deg>146.25 && deg<168.75){return \"SSE\";}\n  else if (deg>168.75 && deg<191.25){return \"S\";}\n  else if (deg>191.25 && deg<213.75){return \"SSW\";}\n  else if (deg>213.75 && deg<236.25){return \"SW\";}\n  else if (deg>236.25 && deg<258.75){return \"WSW\";}\n  else if (deg>258.75 && deg<281.25){return \"W\";}\n  else if (deg>281.25 && deg<303.75){return \"WNW\";}\n  else if (deg>303.75 && deg<326.25){return \"NW\";}\n  else if (deg>326.25 && deg<348.75){return \"NNW\";}\n  else {return \"N\";}\n}\n\nif (units == \"imperial\")\n{\n  msg.payload.current.temp = msg.payload.current.temp.toFixed() + ' °F';\n  msg.payload.current.wind_speed = msg.payload.current.wind_speed.toFixed() + ' mph';\n}\nelse  // metric units\n{\n  msg.payload.current.temp = msg.payload.current.temp.toFixed(1) + ' °C';\n  msg.payload.current.wind_speed = msg.payload.current.wind_speed.toFixed(1) + ' m/s';\n}\n\nmsg.payload.current.wind_cardinal = degreesToCardinal(msg.payload.current.wind_deg);\n\nmsg.payload.current.sunrise = timeConvert(msg.payload.current.sunrise);\nmsg.payload.current.sunset = timeConvert(msg.payload.current.sunset);\n\nvar iconString = 'wi-owm-' + msg.payload.current.weather[0].icon + ' wi-4x';\nicon = {\n    ui_control: {\n        icon: iconString\n    }\n}; \n\nreturn [msg, icon];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":180,"wires":[["b0ee7e02fac70e8a","be7351e1dd02ac9c","358aaf3d94a2e384","1aac7190b8b04cfe","0ff51096c64a0e3a"],["0118c5bf23faa103"]]},{"id":"d5cadd13fcc4a795","type":"change","z":"da1e5a53b04b1d78","name":"Settings","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.lat","pt":"msg","to":"lat","tot":"flow"},{"t":"set","p":"payload.lon","pt":"msg","to":"lon","tot":"flow"},{"t":"set","p":"payload.appid","pt":"msg","to":"0db6fa33838afa1241b6964f8cbd1935","tot":"str"},{"t":"set","p":"payload.units","pt":"msg","to":"metric","tot":"str"},{"t":"set","p":"payload.lang","pt":"msg","to":"en","tot":"str"},{"t":"set","p":"hour24","pt":"flow","to":"true","tot":"bool"},{"t":"set","p":"units","pt":"flow","to":"payload.units","tot":"msg"},{"t":"set","p":"lang","pt":"flow","to":"payload.lang","tot":"msg"},{"t":"set","p":"payload.exclude","pt":"msg","to":"minutely","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":300,"wires":[["e1178f4b5798dcb3"]]},{"id":"ee91c11c148475cc","type":"ui_ui_control","z":"da1e5a53b04b1d78","name":"Update tab","events":"all","x":110,"y":420,"wires":[["f6bac1431837dde8"]]},{"id":"5650d1680d259116","type":"link out","z":"da1e5a53b04b1d78","name":"Refresh","mode":"link","links":["fb1c019a15b2c764"],"x":1385,"y":280,"wires":[]},{"id":"fb1c019a15b2c764","type":"link in","z":"da1e5a53b04b1d78","name":"","links":["5650d1680d259116"],"x":375,"y":340,"wires":[["d5cadd13fcc4a795"]]},{"id":"f6bac1431837dde8","type":"switch","z":"da1e5a53b04b1d78","name":"Tab focus","property":"tab","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":320,"y":420,"wires":[["d5cadd13fcc4a795"]]},{"id":"162150879bfa50d2","type":"ui_button","z":"da1e5a53b04b1d78","name":"","group":"f2c9d6d8312163b5","order":2,"width":"6","height":"1","passthru":false,"label":"Start Watering","tooltip":"","color":"white","bgcolor":"","className":"","icon":"","payload":"Watering cycle started","payloadType":"str","topic":"topic","topicType":"msg","x":160,"y":640,"wires":[["3ea792554450e098"]]},{"id":"9646895f0a9eb9c3","type":"ui_text_input","z":"da1e5a53b04b1d78","name":"","label":"Set value","tooltip":"","group":"e1ed05e8d05a9e01","order":2,"width":"0","height":"0","passthru":true,"mode":"text","delay":"0","topic":"topic","sendOnBlur":true,"className":"","topicType":"msg","x":160,"y":820,"wires":[["c35d734b8c500646"]]},{"id":"e1a60fceb33ba6e4","type":"inject","z":"da1e5a53b04b1d78","name":"Inject","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":1280,"wires":[["9e4df1403f0e0b35"]]},{"id":"9e4df1403f0e0b35","type":"function","z":"da1e5a53b04b1d78","name":"RNG","func":"x = Math.random() * 1000;\nmsg.payload = Math.round(x);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":1280,"wires":[["0dd3f3c51bb74ce0","8e8edaf996cecc25"]]},{"id":"0dd3f3c51bb74ce0","type":"ui_gauge","z":"da1e5a53b04b1d78","name":"","group":"f2c9d6d8312163b5","order":4,"width":0,"height":0,"gtype":"gage","title":"Current Soil Humidity","label":"units","format":"{{value}}","min":0,"max":"1000","colors":["#e01b24","#e6e600","#3584e4"],"seg1":"","seg2":"","className":"","x":600,"y":1280,"wires":[]},{"id":"8e8edaf996cecc25","type":"ui_chart","z":"da1e5a53b04b1d78","name":"","group":"f2c9d6d8312163b5","order":5,"width":0,"height":0,"label":"Soil Humidity Log","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"No data","dot":false,"ymin":"0","ymax":"1000","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"1","cutout":0,"useOneColor":false,"useUTC":true,"colors":["#986a44","#335684","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":590,"y":1360,"wires":[[]]},{"id":"08d1a863f1eb7b06","type":"ui_button","z":"da1e5a53b04b1d78","name":"","group":"e1ed05e8d05a9e01","order":3,"width":0,"height":0,"passthru":false,"label":"OK","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"threshold","payloadType":"flow","topic":"topic","topicType":"msg","x":550,"y":820,"wires":[["1b965fa0736ed4bc"]]},{"id":"669101457d527fd1","type":"ui_text","z":"da1e5a53b04b1d78","group":"f2c9d6d8312163b5","order":1,"width":0,"height":0,"name":"","label":"Status","format":"{{msg.payload}}","layout":"row-spread","className":"","x":830,"y":960,"wires":[]},{"id":"2b7e47fc9fcd47f2","type":"function","z":"da1e5a53b04b1d78","name":"Status Receiver","func":"status = msg.payload;\n\nif(status == 1) {\n  msg.payload = \"Watering\";\n  flow.set(\"status\", 1);\n} else {\n  msg.payload = \"Idling\";\n  flow.set(\"status\", 0);\n}\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":960,"wires":[["669101457d527fd1"]]},{"id":"24c8255e15f4244d","type":"inject","z":"da1e5a53b04b1d78","name":"Inject","props":[{"p":"payload"}],"repeat":"3","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":150,"y":960,"wires":[["30a0109220bc55b5","eaccd36b54b788b5"]]},{"id":"45dcee17b0912e43","type":"function","z":"da1e5a53b04b1d78","name":"Send to flow","func":"const lat = msg.payload.lat;\nconst lon = msg.payload.lon;\n\nflow.set(\"lat\",lat);\nflow.set(\"lon\",lon);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":200,"wires":[["d5cadd13fcc4a795"]]},{"id":"ec4046afab116c6a","type":"ui_form","z":"da1e5a53b04b1d78","name":"","label":"Set location","group":"70fb931.dfc146c","order":11,"width":0,"height":0,"options":[{"label":"Latitude","value":"lat","type":"text","required":true,"rows":null},{"label":"Longtitude","value":"lon","type":"text","required":true,"rows":null}],"formValue":{"lat":"","lon":""},"payload":"","submit":"Submit","cancel":"","topic":"topic","topicType":"msg","splitLayout":true,"className":"","x":110,"y":160,"wires":[["45dcee17b0912e43","1b0f87bcf57538b4","02693e82a6b73510"]]},{"id":"c35d734b8c500646","type":"function","z":"da1e5a53b04b1d78","name":"Set value","func":"flow.set(\"threshold\", msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":820,"wires":[[]]},{"id":"50907519ece9b529","type":"ui_chart","z":"da1e5a53b04b1d78","name":"","group":"f2c9d6d8312163b5","order":6,"width":0,"height":0,"label":"Watering Log","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"No data","dot":false,"ymin":"0","ymax":"1","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"1","cutout":0,"useOneColor":false,"useUTC":true,"colors":["#335684","#335684","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":570,"y":1200,"wires":[[]]},{"id":"3b2f76999fbada0f","type":"comment","z":"da1e5a53b04b1d78","name":"Visual","info":"","x":130,"y":1160,"wires":[]},{"id":"e61d7d61462746df","type":"comment","z":"da1e5a53b04b1d78","name":"Watering Status","info":"","x":120,"y":920,"wires":[]},{"id":"5bb02bab792f5fa1","type":"comment","z":"da1e5a53b04b1d78","name":"Set Threshold","info":"","x":150,"y":780,"wires":[]},{"id":"8bb3209ef0b97655","type":"comment","z":"da1e5a53b04b1d78","name":"Weather Forecast","info":"","x":130,"y":60,"wires":[]},{"id":"99c5da97f63e267a","type":"comment","z":"da1e5a53b04b1d78","name":"Manual Trigger","info":"","x":140,"y":600,"wires":[]},{"id":"1b965fa0736ed4bc","type":"ui_text","z":"da1e5a53b04b1d78","group":"e1ed05e8d05a9e01","order":1,"width":0,"height":0,"name":"","label":"Current value","format":"{{msg.payload}}","layout":"row-spread","className":"","x":760,"y":820,"wires":[]},{"id":"8f246491eec01e12","type":"function","z":"da1e5a53b04b1d78","name":"Get Watering Status","func":"msg.payload = flow.get(\"status\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":1200,"wires":[["50907519ece9b529"]]},{"id":"3af76b94d37ca5ff","type":"link in","z":"da1e5a53b04b1d78","name":"Status","links":["30a0109220bc55b5"],"x":165,"y":1200,"wires":[["8f246491eec01e12"]]},{"id":"30a0109220bc55b5","type":"link out","z":"da1e5a53b04b1d78","name":"Status","mode":"link","links":["3af76b94d37ca5ff","f7eab2f7610d2f17","9fc9be4f0593c4c3"],"x":315,"y":1020,"wires":[]},{"id":"1b0f87bcf57538b4","type":"ui_text","z":"da1e5a53b04b1d78","group":"70fb931.dfc146c","order":9,"width":0,"height":0,"name":"","label":"Current latitude","format":"{{msg.payload.lat}}","layout":"row-spread","className":"","x":320,"y":120,"wires":[]},{"id":"02693e82a6b73510","type":"ui_text","z":"da1e5a53b04b1d78","group":"70fb931.dfc146c","order":10,"width":0,"height":0,"name":"","label":"Current longtitude","format":"{{msg.payload.lon}}","layout":"row-spread","className":"","x":330,"y":160,"wires":[]},{"id":"2c1db77017f48f63","type":"ui_text","z":"da1e5a53b04b1d78","d":true,"group":"70fb931.dfc146c","order":12,"width":0,"height":0,"name":"","label":"rainForecast String","format":"{{msg.payload.rainForecast}}","layout":"row-spread","className":"","x":1270,"y":480,"wires":[]},{"id":"b6b150ace5f7030d","type":"function","z":"da1e5a53b04b1d78","name":"Set forecast string","func":"let rainForecast = \"\";\n\nif (flow.get(\"outdoor\") == 1) {\n    for (let i = 1; i <= 6; i++) {\n        if (msg.payload.hourly[i].weather[0].main == \"Rain\") {\n            rainForecast += \"1\";\n        } else {\n            rainForecast += \"0\";\n        }\n    }\n} else {\n    rainForecast = \"000000\"\n}\n\nconsole.log(rainForecast);\n\nflow.set(\"rain\", rainForecast);\n\nmsg.payload.rain = rainForecast;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":440,"wires":[["2c1db77017f48f63"]]},{"id":"799ca027ffd2edb3","type":"comment","z":"da1e5a53b04b1d78","name":"For testing only","info":"","x":1260,"y":440,"wires":[]},{"id":"7ea09f2132636b36","type":"ui_switch","z":"da1e5a53b04b1d78","name":"","label":"Outdoor","tooltip":"Turn on to switch to outdoor mode which take weather forecast into account","group":"70fb931.dfc146c","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":false,"className":"","x":560,"y":160,"wires":[["c96ccc78bfaeea89"]]},{"id":"c96ccc78bfaeea89","type":"function","z":"da1e5a53b04b1d78","name":"Set mode","func":"if (msg.payload == true) {\n    flow.set(\"outdoor\", 1);\n} else {\n    flow.set(\"outdoor\", 0);\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":160,"wires":[[]]},{"id":"8337d7eaa962de62","type":"comment","z":"da1e5a53b04b1d78","name":"README","info":"If outdoor then weather forecast will be taking into account when deciding to activate watering system.\nElse weather forecast will be ignored.","x":560,"y":120,"wires":[]},{"id":"3ea792554450e098","type":"switch","z":"da1e5a53b04b1d78","name":"Check watering status","property":"status","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":400,"y":640,"wires":[["ca544546d4e37356"],["84f8011f781b85ba"]]},{"id":"9ad36ed0f9d9d46c","type":"ui_button","z":"da1e5a53b04b1d78","name":"","group":"f2c9d6d8312163b5","order":3,"width":"6","height":"1","passthru":false,"label":"Stop Watering","tooltip":"","color":"white","bgcolor":"","className":"","icon":"","payload":"Watering cycle stopped","payloadType":"str","topic":"topic","topicType":"msg","x":140,"y":680,"wires":[["5ec393cb04298df7"]]},{"id":"0d661c4fad620917","type":"ui_toast","z":"da1e5a53b04b1d78","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"className":"","topic":"","name":"Notice","x":850,"y":640,"wires":[[]]},{"id":"ca544546d4e37356","type":"function","z":"da1e5a53b04b1d78","name":"Idling","func":"msg.payload = \"Watering cycle started\";\n\nflow.set(\"status\", 1);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":600,"wires":[["0d661c4fad620917","31b201c56bb821a0"]]},{"id":"84f8011f781b85ba","type":"function","z":"da1e5a53b04b1d78","name":"Watering","func":"msg.payload = \"A watering cycle is already in progress\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":640,"wires":[["0d661c4fad620917"]]},{"id":"5ec393cb04298df7","type":"switch","z":"da1e5a53b04b1d78","name":"Check watering status","property":"status","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":400,"y":680,"wires":[["74140d3168cbdfd2"],["70b195856368c665"]]},{"id":"74140d3168cbdfd2","type":"function","z":"da1e5a53b04b1d78","name":"Idling","func":"msg.payload = \"No watering cycle in progress\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":680,"wires":[["0d661c4fad620917"]]},{"id":"70b195856368c665","type":"function","z":"da1e5a53b04b1d78","name":"Watering","func":"msg.payload = \"Watering cycle stopped\";\n\nflow.set(\"status\", 0);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":720,"wires":[["0d661c4fad620917","31b201c56bb821a0"]]},{"id":"cf2f0a9ff4857aca","type":"link out","z":"da1e5a53b04b1d78","name":"Manual Trigger","mode":"link","links":["ac099b9c6c8d62cf"],"x":1145,"y":700,"wires":[]},{"id":"ac099b9c6c8d62cf","type":"link in","z":"da1e5a53b04b1d78","name":"","links":["cf2f0a9ff4857aca"],"x":455,"y":1020,"wires":[["2b7e47fc9fcd47f2","30a0109220bc55b5"]]},{"id":"eaccd36b54b788b5","type":"function","z":"da1e5a53b04b1d78","name":"RNG","func":"x = Math.random() * 1;\nrandom = Math.round(x);\n\nmsg.payload = random;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":960,"wires":[["2b7e47fc9fcd47f2"]]},{"id":"31b201c56bb821a0","type":"switch","z":"da1e5a53b04b1d78","name":"Switch state","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Watering cycle stopped","vt":"str"},{"t":"eq","v":"Watering cycle started","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":700,"wires":[["714b47d9f0f3ae2b"],["4c31f69cbcbe992a"]]},{"id":"714b47d9f0f3ae2b","type":"change","z":"da1e5a53b04b1d78","name":"stopped","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":680,"wires":[["cf2f0a9ff4857aca"]]},{"id":"4c31f69cbcbe992a","type":"change","z":"da1e5a53b04b1d78","name":"started","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":720,"wires":[["cf2f0a9ff4857aca"]]},{"id":"6c8b15e9f0b0438b","type":"comment","z":"da1e5a53b04b1d78","name":"README","info":"Replace with function to read status sent from Arduino","x":360,"y":920,"wires":[]},{"id":"82085e46864a7d1f","type":"http response","z":"da1e5a53b04b1d78","name":"","statusCode":"200","headers":{},"x":380,"y":1800,"wires":[]},{"id":"7f464bdebe121881","type":"json","z":"da1e5a53b04b1d78","name":"","property":"payload","action":"obj","pretty":true,"x":370,"y":1920,"wires":[["b750af2a1c134666"]]},{"id":"18209bac12168dc1","type":"debug","z":"da1e5a53b04b1d78","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":830,"y":1840,"wires":[]},{"id":"b750af2a1c134666","type":"function","z":"da1e5a53b04b1d78","name":"JSON or URL Encoded","func":"var msg0 = { payload: msg.payload.data };\n\nreturn [msg0];","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":570,"y":1920,"wires":[["18209bac12168dc1","31b97b6a49b360f3"]]},{"id":"9de7898add302f8b","type":"http in","z":"da1e5a53b04b1d78","name":"","url":"post-data","method":"post","upload":false,"swaggerDoc":"","x":160,"y":1840,"wires":[["82085e46864a7d1f","18209bac12168dc1","7f464bdebe121881"]]},{"id":"5889dbdcdbb3a573","type":"http response","z":"da1e5a53b04b1d78","name":"","statusCode":"200","headers":{},"x":520,"y":1540,"wires":[]},{"id":"de084511e9484054","type":"http in","z":"da1e5a53b04b1d78","name":"","url":"/post-data","method":"get","upload":false,"swaggerDoc":"","x":160,"y":1711,"wires":[["322df3fdf9053341"]]},{"id":"fbbb0fd576585582","type":"http response","z":"da1e5a53b04b1d78","name":"","statusCode":"200","headers":{},"x":520,"y":1671,"wires":[]},{"id":"322df3fdf9053341","type":"function","z":"da1e5a53b04b1d78","name":"","func":"msg.payload = {\"data\":\"testing\"};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":1711,"wires":[["fbbb0fd576585582","5f961b11e0a02720"]]},{"id":"5f961b11e0a02720","type":"debug","z":"da1e5a53b04b1d78","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":530,"y":1739,"wires":[]},{"id":"81bc32f486f1c448","type":"debug","z":"da1e5a53b04b1d78","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":530,"y":1611,"wires":[]},{"id":"7569fed581e0896e","type":"http in","z":"da1e5a53b04b1d78","name":"","url":"/get-data","method":"get","upload":false,"swaggerDoc":"","x":150,"y":1580,"wires":[["f4f79605d7fafc24"]]},{"id":"f4f79605d7fafc24","type":"function","z":"da1e5a53b04b1d78","name":"","func":"msg.payload = msg.payload.data;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":1580,"wires":[["81bc32f486f1c448","5889dbdcdbb3a573"]]},{"id":"680c05be308a8403","type":"comment","z":"da1e5a53b04b1d78","name":"ESP32","info":"","x":130,"y":1480,"wires":[]},{"id":"31b97b6a49b360f3","type":"function","z":"da1e5a53b04b1d78","name":"Update data","func":"flow.set(\"data\", msg.payload.data);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":830,"y":1920,"wires":[[]]},{"id":"873b86844395c2e1","type":"comment","z":"da1e5a53b04b1d78","name":"To receive incoming requests","info":"","x":200,"y":1540,"wires":[]},{"id":"9de12ca715b21ac2","type":"comment","z":"da1e5a53b04b1d78","name":"To send data to ESP","info":"","x":170,"y":1680,"wires":[]},{"id":"70fb931.dfc146c","type":"ui_group","name":"Weather","tab":"4bb34f67.69a87","order":4,"disp":false,"width":"10","collapse":false,"className":""},{"id":"f2c9d6d8312163b5","type":"ui_group","name":"Data","tab":"4bb34f67.69a87","order":3,"disp":true,"width":"6","collapse":false,"className":""},{"id":"e1ed05e8d05a9e01","type":"ui_group","name":"Humidity Threshold","tab":"4bb34f67.69a87","order":5,"disp":true,"width":"6","collapse":false,"className":""},{"id":"4bb34f67.69a87","type":"ui_tab","name":"CapstoneProject","icon":"fa-thermometer-half","order":3,"disabled":false,"hidden":false}]